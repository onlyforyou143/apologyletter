<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animated Letter</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f5f5f5;
      font-family: 'Georgia', serif;
      perspective: 1500px;
      overflow: hidden;
    }

    .scene {
      width: 400px;
      height: 520px;
      position: relative;
    }

    .envelope {
      position: absolute;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 1s;
      cursor: pointer;
    }

    .envelope.open {
      transform: rotateX(180deg);
    }

    .envelope-front, .envelope-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .envelope-front {
      background-color: #ffe0b2;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
    }

    .envelope-back {
      background-color: #ffe0b2;
      transform: rotateX(180deg);
    }

    .envelope-seal {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background-color: #b71c1c;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-weight: bold;
      font-family: 'Courier New', monospace;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .address {
      font-style: italic;
      text-align: center;
      font-size: 14px;
      line-height: 1.6;
      margin-top: 80px;
    }

    .stamp {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 60px;
      background-color: #f5f5f5;
      border: 1px solid #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 10px;
      text-align: center;
      line-height: 1.2;
    }

    .letter {
      position: absolute;
      width: 85%;
      height: 85%;
      background-color: #fff;
      padding: 30px;
      box-sizing: border-box;
      font-size: 16px;
      line-height: 1.6;
      overflow: auto;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      opacity: 0;
      transition: opacity 0.5s;
      border-radius: 5px;
    }

    .letter.show {
      opacity: 1;
    }

    .letter-content {
      position: relative;
    }

    .date {
      text-align: right;
      margin-bottom: 20px;
    }

    .signature {
      margin-top: 30px;
      font-style: italic;
      text-align: right;
    }

    .click-hint {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: #666;
      opacity: 1;
      transition: opacity 0.5s;
    }

    .click-hint.hide {
      opacity: 0;
    }

    @keyframes pulse {
      0% { transform: scale(1) translateX(-50%); }
      50% { transform: scale(1.05) translateX(-47.6%); }
      100% { transform: scale(1) translateX(-50%); }
    }

    .click-hint {
      animation: pulse 2s infinite;
    }

    .small-heart {
      font-size: 8px;
      color: #b71c1c;
      margin: 0 2px;
    }

    .music-controls {
      position: absolute;
      bottom: 10px;
      right: 10px;
      display: flex;
      align-items: center;
      gap: 5px;
      opacity: 0;
      transition: opacity 0.5s;
    }

    .music-controls.show {
      opacity: 1;
    }

    .volume-control {
      width: 60px;
      height: 5px;
    }

    /* Adding new class for file upload */
    .upload-container {
      position: absolute;
      bottom: 10px;
      left: 10px;
      opacity: 0.7;
      transition: opacity 0.3s;
    }

    .upload-container:hover {
      opacity: 1;
    }
    
    .upload-container label {
      display: inline-block;
      cursor: pointer;
      padding: 5px 10px;
      background: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
    }
    
    .upload-container input {
      display: none;
    }
  </style>
</head>
<body>
  <div class="scene">
    <div class="envelope">
      <div class="envelope-front">
        <div class="stamp">POSTAGE<br>PAID<br>2025</div>
        <div class="address">
          To my dearest,<br>
          My Love<br>
          Forever in My Heart<br>
          ‚ô•
        </div>
      </div>
      <div class="envelope-back">
        <div class="envelope-seal">‚ù§Ô∏è</div>
      </div>
    </div>
    
    <div class="letter">
      <div class="letter-content">
        <div class="date">March 22, 2025</div>
        
        <p>My dearest Senorita,</p>
        
        <p>I find myself writing this with a heavy heart and trembling hands. I'm truly, deeply sorry for what I've done. The recklessness I've shown has put a strain on the beautiful relationship we've built together, and for that, I am genuinely remorseful.</p>
        
        <p>I'm especially sorry for getting mad at you when you didn't deserve it. My anger was misplaced, my words harsh, and my behavior inexcusable. Instead of communicating my feelings properly, I lashed out at the person I care about most in this world. That was wrong of me on every level.</p>
        
        <p>When I think about how my actions made you feel - the hurt in your eyes, the pain in your voice - it breaks my heart. You've always been there for me, supporting me through everything, and this is how I repaid your kindness. I was selfish and thoughtless.</p>
        
        <p>I remember how we used to laugh together, how your smile would light up the room, how safe we felt in each other's arms. I've put all of that at risk because I couldn't control my emotions or think before I acted. The thought of losing what we have terrifies me.</p>
        
        <p>I want you to know that I've been reflecting deeply on my behavior. I understand now how my recklessness affects not just me, but us. I see how my angry outbursts create wounds that take time to heal. This isn't who I want to be, especially not with you.</p>
        
        <p>If you give me another chance, I promise to work on being more mindful, more patient, and more deserving of your love. I promise to think before I speak, to consider your feelings before I act, and to never take you for granted again. I want to be the person who brings joy to your life, not pain.</p>
        
        <p>I understand if you need space or time to think. I understand if this letter doesn't immediately fix what I've broken. Real change takes time, and I'm committed to putting in that time and effort - for you, for us, for our future together.</p>
        
        <p>You deserve someone who treats you with constant respect, unwavering kindness, and boundless love. I want to be that person for you. I want to make you proud to be with me again.</p>
        
        <p>Please know that no matter what happens, my heart is yours. I love you more than words can express, and I'm truly, deeply sorry for hurting you.</p>
        
        <div class="signature">With all my love, regret, and hope for forgiveness, Kenzie</div>
      </div>
    </div>
    
    <div class="click-hint">Click to open the letter</div>

    <div class="music-controls">
      <button id="play-btn">‚ñ∂Ô∏è</button>
      <button id="pause-btn">‚è∏Ô∏è</button>
      <button id="mute-btn">üîä</button>
      <input type="range" id="volume-control" class="volume-control" min="0" max="1" step="0.1" value="0.7">
    </div>
    
    <!-- Add the file upload container -->
    <div class="upload-container">
      <label for="audio-file">Select Music</label>
      <input type="file" id="audio-file" accept="audio/*">
    </div>
  </div>

  <!-- Add audio element -->
  <audio id="background-music" loop>
    <!-- Default backup audio - replace with your own hosted file -->
    <source id="audio-source" src="apology.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <script>
    const envelope = document.querySelector('.envelope');
    const letter = document.querySelector('.letter');
    const clickHint = document.querySelector('.click-hint');
    const backgroundMusic = document.getElementById('background-music');
    const audioSource = document.getElementById('audio-source');
    const muteBtn = document.getElementById('mute-btn');
    const playBtn = document.getElementById('play-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const volumeControl = document.getElementById('volume-control');
    const musicControls = document.querySelector('.music-controls');
    const audioFileInput = document.getElementById('audio-file');
    
    let isOpen = false;
    let isMuted = false;
    let previousVolume = 0.7;

    // Set initial volume
    backgroundMusic.volume = volumeControl.value;

    // File upload handling
    audioFileInput.addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        const objectURL = URL.createObjectURL(file);
        backgroundMusic.src = objectURL;
        backgroundMusic.load();
        if (isOpen && !isMuted) {
          backgroundMusic.play();
        }
      }
    });

    // Play button
    playBtn.addEventListener('click', () => {
      backgroundMusic.play();
    });

    // Pause button
    pauseBtn.addEventListener('click', () => {
      backgroundMusic.pause();
    });

    // Mute toggle
    muteBtn.addEventListener('click', () => {
      isMuted = !isMuted;
      
      if (isMuted) {
        muteBtn.textContent = 'üîá';
        previousVolume = backgroundMusic.volume;
        backgroundMusic.volume = 0;
      } else {
        muteBtn.textContent = 'üîä';
        backgroundMusic.volume = previousVolume;
        if (isOpen) backgroundMusic.play();
      }
    });

    // Volume control
    volumeControl.addEventListener('input', () => {
      backgroundMusic.volume = volumeControl.value;
      if (volumeControl.value > 0) {
        isMuted = false;
        muteBtn.textContent = 'üîä';
        previousVolume = volumeControl.value;
      } else {
        isMuted = true;
        muteBtn.textContent = 'üîá';
      }
    });

    // Envelope click handling
    envelope.addEventListener('click', () => {
      if (!isOpen) {
        envelope.classList.add('open');
        clickHint.classList.add('hide');
        
        setTimeout(() => {
          letter.classList.add('show');
          musicControls.classList.add('show');
          
          // Start playing the music
          if (!isMuted) {
            backgroundMusic.play().catch(error => {
              console.log("Audio play failed, possibly due to user interaction needed:", error);
            });
          }
        }, 500);
        
        isOpen = true;
      } else {
        letter.classList.remove('show');
        musicControls.classList.remove('show');
        
        // Pause music when envelope closes
        backgroundMusic.pause();
        
        setTimeout(() => {
          envelope.classList.remove('open');
          clickHint.classList.remove('hide');
        }, 500);
        
        isOpen = false;
      }
    });
  </script>
</body>
</html>
